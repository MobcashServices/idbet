<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>تسجيل الدخول</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet" />
<style>
:root{--header-h:60px;--brand:#e50914}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Tajawal',sans-serif;background:#f5f5f5;direction:rtl;color:#333}
header{height:var(--header-h);background:#fff;display:flex;align-items:center;padding:0 18px;box-shadow:0 2px 6px rgba(0,0,0,.05);border-bottom:1px solid #eee}
.idbet{color:var(--brand);font-size:1.1rem;font-weight:700}
.header-brand{display:flex;gap:8px;align-items:center;font-weight:500}
.slogan{font-size:.85rem;color:#555}.separator{color:#ccc}
main{display:flex;justify-content:center;padding:26px 12px}
.login-box{background:#fff;padding:26px 18px;max-width:340px;width:100%;box-shadow:0 3px 12px rgba(0,0,0,.08)}
.title-wrapper{display:flex;align-items:center;gap:7px;font-size:1.2rem;font-weight:700;margin-bottom:14px}
.step-box{width:30px;height:30px;border-radius:50%;background:var(--brand);color:#fff;display:flex;align-items:center;justify-content:center;font-size:.9rem}
.input-label{margin-bottom:5px;font-weight:600;display:flex;gap:5px;font-size:.9rem}
.info-icon{width:20px;height:20px;border:2px solid #666;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.9rem;color:#666;cursor:help;transition:.3s}
.info-icon:hover{border-color:var(--brand);background:rgba(229,9,20,.1);color:var(--brand)}
.input-group{margin-bottom:12px}
input[type=text]{width:100%;padding:8px;font-size:.9rem;border:1px solid #ccc;border-radius:7px}
.error-message{font-size:.8rem;height:18px;margin-top:4px;transition:.3s}
.platform-icons{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:16px 0;justify-items:center}
.icon{position:relative;width:80px;height:80px;border-radius:10px;background:#fff;box-shadow:0 2px 5px rgba(0,0,0,.05);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:6px;border:1px solid #eee;cursor:pointer;transition:.25s}
.icon:hover{transform:translateY(-2px) scale(1.03)}
.icon.selected{border-color:var(--brand);box-shadow:0 0 8px rgba(229,9,20,.25)}
.icon.selected::after{content:"✓";position:absolute;top:3px;left:3px;width:15px;height:15px;border-radius:50%;background:var(--brand);color:#fff;font-size:8px;display:flex;align-items:center;justify-content:center}
.icon img{height:34px;max-width:90%;object-fit:contain}
.icon-name{margin-top:3px;font-size:.7rem;font-weight:600;text-align:center}
.login-btn{background:var(--brand);color:#fff;font-weight:700;border:none;padding:8px 14px;width:100%;border-radius:7px;cursor:pointer;transition:.25s;font-size:.9rem}
.login-btn:disabled{background:#ccc;cursor:not-allowed}
.login-btn:hover:not(:disabled){background:#b20710}
.btn-spinner,.loader{display:inline-block;border-radius:50%;animation:spin .8s linear infinite;vertical-align:middle}
.btn-spinner{width:14px;height:14px;border:3px solid rgba(255,255,255,.6);border-top:3px solid #fff;margin-right:4px}
.loader{width:12px;height:12px;border:2px solid var(--brand);border-top-color:transparent;margin-left:3px}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<header>
  <div class="header-brand">
    <span class="idbet">Idbet</span><span class="separator">|</span><span class="slogan">وكيل الشحن الرسمي</span>
  </div>
</header>

<main>
  <section class="login-box">
    <div class="title-wrapper"><div class="step-box">1</div><h2>تسجيل الدخول</h2></div>

    <div class="input-label">
      <label for="player-id-1">معرّف اللاعب</label>
      <span class="info-icon" title="رقم مكوَّن من 10 أرقام">?</span>
    </div>

    <div class="input-group">
      <input id="player-id-1" type="text" placeholder="أدخل المعرّف الـ ID" maxlength="10" />
      <div class="error-message" id="error-message"></div>
    </div>

    <div class="platform-icons" id="platforms">
      <div class="icon" data-name="LineBet"><img src="https://i.postimg.cc/x1p0KbfL/cropped-linebet-logo.png" alt="LineBet"><div class="icon-name">LineBet</div></div>
      <div class="icon" data-name="MegaPari"><img src="https://i.postimg.cc/3RRJsCtS/Wh7-Gu-Bom34-Xq4-Bu-QN5n-Qlj-XPXf-V6-CZothm-Lsl6a-S.webp" alt="MegaPari"><div class="icon-name">MegaPari</div></div>
      <div class="icon" data-name="Melbet"><img src="https://i.postimg.cc/wjCr86FS/melbet.png" alt="Melbet"><div class="icon-name">Melbet</div></div>
      <div class="icon" data-name="Gooobet"><img src="https://i.postimg.cc/NMyXmrWn/c943dc665c7e8926e8fb15cadd4e1eee.jpg" alt="Gooobet"><div class="icon-name">Gooobet</div></div>
      <div class="icon" data-name="1xBet"><img src="https://i.postimg.cc/PrMCL4Cx/1-XBet-Casino-1200x900-1.png" alt="1xBet"><div class="icon-name">1xBet</div></div>
    </div>

    <button class="login-btn" id="login-btn" disabled>تسجيل الدخول</button>
  </section>
</main>

<script>
/* ======== رابط Apps Script الجديد ======== */
const scriptURL = 'https://script.google.com/macros/s/AKfycbxBQqVKs5nLkTyIG2LVC-0NSULF18zivzT3EEyvAM-mgfdmJX5jIhciRnBkbX-ww4vC/exec';

const input   = document.getElementById('player-id-1');
const errMsg  = document.getElementById('error-message');
const btn     = document.getElementById('login-btn');
const icons   = document.querySelectorAll('.icon');

let platform  = null;
const repReg  = /^(\d)\1{9}$/;   // 10 أرقام مكرّرة

input.addEventListener('keydown', e=>{
  const ok=['Backspace','Delete','ArrowLeft','ArrowRight','Tab'];
  if(!ok.includes(e.key) && !/^\d$/.test(e.key)) e.preventDefault();
});

input.addEventListener('input', validate);

icons.forEach(icon=>{
  icon.addEventListener('click',()=>{
    icons.forEach(i=>i.classList.remove('selected'));
    icon.classList.add('selected');
    platform = icon.dataset.name;
    validate();
  });
});

function validate(){
  const val = input.value.replace(/\D/g,'');
  input.value = val;
  let msg='', color='var(--brand)';

  if(!val){
    msg='يُرجى إدخال المعرّف للمتابعة.';
  }else if(val.length<10){
    msg='<span class="loader"></span> جارٍ الفحص...';
  }else if(repReg.test(val)){
    msg='المعرّف غير مقبول.';
  }else if(!platform){
    msg='المعرّف صحيح، اختر المنصة.';
    color='green';
  }
  errMsg.innerHTML=msg;
  errMsg.style.color=color;
  btn.disabled = !!msg && !msg.includes('loader');
}

btn.addEventListener('click',async e=>{
  e.preventDefault();
  if(btn.disabled) return;

  btn.innerHTML='<span class="btn-spinner"></span> جارٍ الحفظ...';
  btn.disabled=true;

  try{
    const res = await fetch(scriptURL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({platform, userId: input.value})
    });
    const json = await res.json();
    if(json.status==='success'){
      btn.innerHTML='✔ تم الحفظ';
    }else{
      throw new Error(json.message||'');
    }
  }catch(err){
    btn.innerHTML='خطأ في الحفظ';
    console.error(err);
    setTimeout(()=>{btn.innerHTML='تسجيل الدخول'; validate();},3000);
  }
});
</script>

</body>
</html>
