<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تسجيل الدخول</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --brand: #e50914;
      --header-height: 64px;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Tajawal', sans-serif;
      background: #f5f5f5;
      color: #333;
      direction: rtl;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      height: var(--header-height);
      background: #fff;
      display: flex;
      align-items: center;
      padding: 0 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      border-bottom: 1px solid #eee;
    }
    .header-brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 500;
      font-size: 1.15rem;
    }
    .idbet {
      color: var(--brand);
      font-weight: 700;
    }
    .separator {
      color: #ccc;
    }
    .slogan {
      color: #555;
      font-size: 0.9rem;
    }
    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 28px 14px;
    }
    .login-box {
      background: #fff;
      padding: 28px 24px;
      width: 100%;
      max-width: 380px;
      box-shadow: 0 3px 14px rgba(0,0,0,0.08);
      border-radius: 8px;
    }
    .title-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 20px;
    }
    .step-box {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--brand);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1rem;
      user-select: none;
    }
    label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 6px;
      cursor: pointer;
    }
    .info-icon {
      width: 20px;
      height: 20px;
      border: 2px solid #666;
      border-radius: 50%;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.85rem;
      cursor: help;
      user-select: none;
      transition: 0.3s;
    }
    .info-icon:hover {
      border-color: var(--brand);
      background: rgba(229,9,20,0.1);
      color: var(--brand);
    }
    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      outline: none;
      transition: border-color 0.3s;
    }
    input[type="text"]:focus {
      border-color: var(--brand);
      box-shadow: 0 0 6px rgba(229,9,20,0.3);
    }
    .error-message {
      min-height: 22px;
      margin-top: 5px;
      font-size: 0.85rem;
      color: var(--brand);
      font-weight: 600;
      transition: color 0.3s;
      user-select: none;
    }
    .platform-icons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 20px 0 28px 0;
      justify-items: center;
    }
    .icon {
      width: 80px;
      height: 80px;
      background: #fff;
      border: 1px solid #eee;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 8px;
      cursor: pointer;
      transition: transform 0.25s, box-shadow 0.25s, border-color 0.25s;
      user-select: none;
      position: relative;
    }
    .icon img {
      height: 36px;
      max-width: 90%;
      object-fit: contain;
    }
    .icon-name {
      margin-top: 6px;
      font-weight: 600;
      font-size: 0.75rem;
      color: #333;
      text-align: center;
    }
    .icon:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 5px 12px rgba(0,0,0,0.1);
    }
    .icon.selected {
      border-color: var(--brand);
      box-shadow: 0 0 12px rgba(229,9,20,0.3);
    }
    .icon.selected::after {
      content: "✓";
      position: absolute;
      top: 6px;
      left: 6px;
      width: 18px;
      height: 18px;
      background: var(--brand);
      color: white;
      border-radius: 50%;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }
    button.login-btn {
      width: 100%;
      padding: 11px 0;
      background: var(--brand);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.25s;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    button.login-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    button.login-btn:not(:disabled):hover {
      background: #b20710;
    }
    .btn-spinner {
      border: 3px solid rgba(255,255,255,0.6);
      border-top: 3px solid #fff;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .success-message {
      color: green;
      font-weight: 700;
      text-align: center;
      margin-top: 12px;
      user-select: none;
    }
  </style>
</head>
<body>

<header>
  <div class="header-brand">
    <span class="idbet">Idbet</span><span class="separator">|</span><span class="slogan">وكيل الشحن الرسمي</span>
  </div>
</header>

<main>
  <section class="login-box" aria-label="نموذج تسجيل الدخول">
    <div class="title-wrapper">
      <div class="step-box" aria-hidden="true">1</div>
      <h2>تسجيل الدخول</h2>
    </div>

    <form id="login-form" novalidate>
      <label for="player-id">معرّف اللاعب
        <span class="info-icon" title="رقم مكوَّن من 10 أرقام">?</span>
      </label>
      <input
        type="text"
        id="player-id"
        name="player-id"
        inputmode="numeric"
        pattern="\d{10}"
        maxlength="10"
        placeholder="أدخل المعرّف الـ ID"
        autocomplete="off"
        required
        aria-describedby="error-message"
      />
      <div class="error-message" id="error-message" aria-live="polite"></div>

      <div class="platform-icons" id="platforms" role="list" aria-label="اختيار المنصة">
        <div class="icon" role="listitem" tabindex="0" data-name="LineBet" aria-label="LineBet">
          <img src="https://i.postimg.cc/x1p0KbfL/cropped-linebet-logo.png" alt="شعار LineBet" />
          <div class="icon-name">LineBet</div>
        </div>
        <div class="icon" role="listitem" tabindex="0" data-name="MegaPari" aria-label="MegaPari">
          <img src="https://i.postimg.cc/3RRJsCtS/Wh7-Gu-Bom34-Xq4-Bu-QN5n-Qlj-XPXf-V6-CZothm-Lsl6a-S.webp" alt="شعار MegaPari" />
          <div class="icon-name">MegaPari</div>
        </div>
        <div class="icon" role="listitem" tabindex="0" data-name="Melbet" aria-label="Melbet">
          <img src="https://i.postimg.cc/wjCr86FS/melbet.png" alt="شعار Melbet" />
          <div class="icon-name">Melbet</div>
        </div>
        <div class="icon" role="listitem" tabindex="0" data-name="Gooobet" aria-label="Gooobet">
          <img src="https://i.postimg.cc/NMyXmrWn/c943dc665c7e8926e8fb15cadd4e1eee.jpg" alt="شعار Gooobet" />
          <div class="icon-name">Gooobet</div>
        </div>
        <div class="icon" role="listitem" tabindex="0" data-name="1xBet" aria-label="1xBet">
          <img src="https://i.postimg.cc/PrMCL4Cx/1-XBet-Casino-1200x900-1.png" alt="شعار 1xBet" />
          <div class="icon-name">1xBet</div>
        </div>
      </div>

      <button type="submit" class="login-btn" disabled aria-disabled="true" aria-live="polite">
        تسجيل الدخول
      </button>
      <div class="success-message" id="success-message" role="alert" aria-live="polite"></div>
    </form>
  </section>
</main>

<script>
  (() => {
    const input = document.getElementById('player-id');
    const errorMessage = document.getElementById('error-message');
    const btn = document.querySelector('button.login-btn');
    const successMessage = document.getElementById('success-message');
    const icons = document.querySelectorAll('.icon');
    let selectedPlatform = null;

    // إزالة رسالة النجاح عند تعديل الإدخال
    function resetMessages() {
      errorMessage.textContent = '';
      successMessage.textContent = '';
    }

    // التحقق من صحة الإدخال
    function validate() {
      const val = input.value.trim();
      const idValid = /^\d{10}$/.test(val);
      const platformSelected = !!selectedPlatform;

      if (idValid && platformSelected) {
        errorMessage.textContent = 'جاهز للإرسال';
        errorMessage.style.color = 'green';
        btn.disabled = false;
        btn.setAttribute('aria-disabled', 'false');
      } else {
        errorMessage.textContent = 'أدخل معرفًا صحيحًا واختر المنصة';
        errorMessage.style.color = 'var(--brand)';
        btn.disabled = true;
        btn.setAttribute('aria-disabled', 'true');
      }
    }

    // اختيار المنصة
    icons.forEach(icon => {
      icon.addEventListener('click', () => {
        selectedPlatform = icon.dataset.name;
        icons.forEach(i => i.classList.remove('selected'));
        icon.classList.add('selected');
        resetMessages();
        validate();
      });
      icon.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          icon.click();
        }
      });
    });

    input.addEventListener('input', () => {
      // السماح بالأرقام فقط
      input.value = input.value.replace(/\D/g, '');
      resetMessages();
      validate();
    });

    // إرسال البيانات
    document.getElementById('login-form').addEventListener('submit', async e => {
      e.preventDefault();
      if (btn.disabled) return;

      btn.disabled = true;
      btn.innerHTML = '<span class="btn-spinner" aria-hidden="true"></span> إرسال...';

      const payload = {
        userId: input.value,
        platform: selectedPlatform
      };

      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbzQXqfYK3rzSSR-ZKYDxsa1iqTQUpfflHnDZQVnU3hKxNoLG0j3gPO0KIijH5YZelQg3A/exec', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });

        const result = await response.json();

        if(result.status === 'success'){
          successMessage.textContent = 'تم الإرسال بنجاح!';
          errorMessage.textContent = '';
          btn.innerHTML = 'تم الإرسال';
          btn.disabled = true;
          btn.setAttribute('aria-disabled', 'true');
          // هنا يمكنك إعادة التوجيه لو تريد، مثال:
          // window.location.href = 'home.html';
        } else {
          throw new Error(result.message || 'فشل في الإرسال');
        }
      } catch (error) {
        errorMessage.textContent = 'حدث خطأ أثناء الإرسال، حاول مرة أخرى';
        errorMessage.style.color = 'var(--brand)';
        btn.innerHTML = 'تسجيل الدخول';
        btn.disabled = false;
        btn.setAttribute('aria-disabled', 'false');
      }
    });
  })();
</script>

</body>
</html>
